<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css">
    <title>Document Processor</title>
</head>
<body class="flex flex-col items-center p-5">
    <form>
        <input type="file" accept="text/*" multiple="multiple">
    </form>
    <div>
        <ul>
        </ul>
    </div>
    <button class="btn-blue" disabled>Upload</button>
    <p></p>

    <div>
        <canvas id="freqChart"></canvas>
    </div>

    <script src="/assets/chart.js.js"></script>
    <script>
        const ctx = document.getElementById('freqChart');

        function draw(labels, data) {
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Frequency',
                        data,
                        borderWidth: 0,
                        barThickness: 10,
                    }],
                },
            });
        }
    </script>
    <script>
        const fileInput = document.querySelector('input[type=file]');
        const ul = document.querySelector('ul');
        const p = document.querySelector('p');
        const btn = document.querySelector('button');

        fileInput.onchange = async () => {
            ul.innerHTML = '';
            btn.disabled = fileInput.files.length <= 0;

            for (const file of fileInput.files) {
                ul.innerHTML += `<li>${file.name}</li>`;
            }
        };

        btn.onclick = async () => {
            btn.disabled = true;
            p.innerText = 'Uploading...';

            const files = [];
            for (const file of fileInput.files)
                files.push({name: file.name, content: await file.text()});

            const res = await fetch('/process', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    files,
                }),
            });

            if (res.ok) {
                const data = await res.json();
                p.innerText = `${data.text}`;
                draw(data.graphData.labels, data.graphData.data);
            } else {
                p.innerText = res.statusText;
            }
        };
    </script>
</body>
</html>